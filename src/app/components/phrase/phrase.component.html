<div
    class="py-2 px-4 rounded-md bg-white shadow-md border border-gray-300 phrase-component"
    [title]="translatedPhrase().id"
>
    <div class="flex justify-between items-center gap-6 max-sm:flex-col">
        @if (showSelectCheckbox()) {
            <input
                type="checkbox"
                class="checkbox checkbox-sm phrase-component__select-checkbox"
                (click)="toggleSelect()"
                [checked]="isSelected()"
            />
        }
        <button
            class="grow text-left cursor-pointer phrase-component__original"
            (click)="revealTranslation()"
            [title]="translatedPhrase().original.id"
        >
            {{ translatedPhrase().original.text }}
        </button>
        <div
            class="flex max-sm:justify-between justify-end items-center max-sm:w-full gap-6"
        >
            <div class="flex gap-6">
                @if (showReviewDate()) {
                    <div
                        class="text-sm text-gray-500 text-nowrap phrase-component__review-date"
                    >
                        {{ translatedPhrase().review_date | date: 'd MMM YY' }}
                    </div>
                }
                @if (showStage()) {
                    <div
                        class="text-xs text-gray-500 text-nowrap phrase-component__stage"
                    >
                        Stage {{ translatedPhrase().sr_stage_id }}
                    </div>
                }
            </div>
            <div class="flex gap-2">
                @if (showDeleteButton()) {
                    @if (busy()) {
                        <span class="loading loading-spinner loading-xs"></span>
                    } @else {
                        <button
                            class="cursor-pointer phrase-component__delete-button text-red-600 hover:text-red-800"
                            (click)="requestDelete()"
                        >
                            <app-icon
                                type="trash"
                                customClass="max-sm:size-7"
                            />
                        </button>
                    }
                }
                @if (showEdit()) {
                    <button class="cursor-pointer" (click)="editVocabulary()">
                        <app-icon type="pencil" customClass="max-sm:size-7" />
                    </button>
                }
                @if (isReviewLoading()) {
                    <span class="loading loading-spinner loading-xs"></span>
                } @else {
                    <button
                        class="cursor-pointer phrase-component__review-button"
                        (click)="setReviewedVocabulary(translatedPhrase().id)"
                    >
                        <app-icon
                            type="check-circle"
                            customClass="max-sm:size-7"
                        />
                    </button>
                }
                @if (loadingAudioId() === translatedPhrase().original.id) {
                    <span class="loading loading-spinner loading-xs"></span>
                } @else {
                    <button
                        class="cursor-pointer phrase-component__play-audio--original"
                        (click)="playAudio(translatedPhrase().original.id)"
                    >
                        <app-icon
                            type="play"
                            customClass="size-7 max-sm:size-8"
                        />
                    </button>
                }

                @if (showMenu()) {
                    <button
                        #optionsMenuTrigger
                        class="cursor-pointer phrase-component__options-button"
                        [cdkMenuTriggerFor]="phraseOptionsMenu"
                        cdkMenuTriggerCloseSource="click"
                    >
                        @if (busy()) {
                            <span
                                class="loading loading-spinner loading-xs"
                            ></span>
                        } @else {
                            <app-icon
                                type="ellipsis-horizontal"
                                customClass="max-sm:size-7"
                            />
                        }
                    </button>

                    <ng-template #phraseOptionsMenu>
                        <div cdkMenu>
                            <app-options-menu
                                class="phrase-component__options-menu"
                                (emitDelayDays)="
                                    delay([translatedPhrase().id], $event)
                                "
                                (emitReset)="reset([translatedPhrase().id])"
                                (emitRestart)="restart([translatedPhrase().id])"
                                (emitDelete)="requestDelete()"
                                [disabled]="busy()"
                            />
                        </div>
                    </ng-template>
                }
            </div>
        </div>
    </div>
    @if (isTranlationVisible()) {
        <div class="pt-2 mt-2 border-t border-dotted border-gray-300">
            <div class="flex justify-between items-center">
                <div
                    class="flex gap-3 items-center phrase-component__translated"
                    [title]="translatedPhrase().translated.id"
                >
                    {{ translatedPhrase().translated.text }}
                </div>
                <div>
                    @if (
                        loadingAudioId() === translatedPhrase().translated.id
                    ) {
                        <span class="loading loading-spinner loading-xs"></span>
                    } @else {
                        <button
                            class="cursor-pointer phrase-component__play-audio--translated"
                            (click)="
                                playAudio(translatedPhrase().translated.id)
                            "
                        >
                            <app-icon
                                type="play"
                                customClass="size-7 max-sm:size-8"
                            />
                        </button>
                    }
                </div>
            </div>
        </div>
    }
</div>

@if (isDeleteConfirmOpen()) {
    <app-delete-confirm-modal
        [count]="1"
        [busy]="busy()"
        (cancelModal)="cancelDelete()"
        (confirm)="confirmDelete([translatedPhrase().id])"
    />
}
