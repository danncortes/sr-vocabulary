import{a as M,d as V,e as N,g as k,i as D,j as q,p as j,q as I,r as O}from"./chunk-553BNLEO.js";import{i as E}from"./chunk-5W4MO4JS.js";import{Ab as _,J as F,Ka as S,Ma as o,Q as y,Qa as L,Wa as A,_a as g,eb as u,fb as x,hb as c,ja as d,ka as p,kb as a,lb as r,m as h,mb as b,ob as T,qb as f,rb as m,xb as v,ya as l,yb as s}from"./chunk-3UVZE6IW.js";function U(i,t){if(i&1&&(a(0,"div",11),s(1),r()),i&2){let e=m();o(),_(" ",e.errorMessage()," ")}}function Q(i,t){i&1&&b(0,"span",14)}function z(i,t){if(i&1&&(a(0,"button",12),s(1),g(2,Q,1,0,"span",14),r()),i&2){let e=m(),n=v(10);u("disabled",!n.valid||e.isLoading()),o(),_(" ",e.isLoading()?"Logging in...":"Login with 2FA"," "),o(),c(e.isLoading()?2:-1)}}function G(i,t){if(i&1&&(a(0,"button",13),s(1),r()),i&2){let e=m(),n=v(10);u("disabled",!n.valid||e.isLoading()),o(),_(" ",e.isLoading()?"Loading...":"Get 2FA QR"," ")}}function W(i,t){if(i&1&&(a(0,"h3",15),s(1," Scan this QR code with your authenticator app: "),r(),b(2,"img",16)),i&2){let e=m();o(2),u("src",e.qrCodeUrl(),S)}}var P=class i{constructor(t){this.authService=t}isLoading=l(!1);errorMessage=l("");subscriptions=[];qrCodeUrl=l("");twoFactorloginActive=l(!0);onSubmit(t){if(t.valid){this.errorMessage.set(""),this.isLoading.set(!0);let e=this.getTwoFactorCode().pipe(y(n=>this.authService.login(t.value.email,t.value.password,n)),F(()=>{this.isLoading.set(!1)})).subscribe({error:n=>{this.errorMessage.set(n.message||"Login failed")}});this.subscriptions.push(e)}}getTwoFactorCode(){return h(new Promise(t=>{let e=prompt("Enter your 2FA code:");t(e||"")}))}setTwoFactorloginActive(t){this.twoFactorloginActive.set(t)}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}static \u0275fac=function(e){return new(e||i)(L(E))};static \u0275cmp=A({type:i,selectors:[["app-login"]],decls:20,vars:7,consts:[["loginForm","ngForm"],[1,"h-screen","bg-gray-200","flex","justify-center","items-center"],[1,"p-6","bg-white","rounded-lg","shadow-lg","w-96"],[1,"mb-6","text-xl"],[1,"join","mb-6","w-full"],[1,"btn","btn-sm","join-item","basis-1/2",3,"click"],[3,"ngSubmit"],["type","email","id","email","name","email","ngModel","","required","","email","","placeholder","Email",1,"input","input-bordered","block","mb-6","w-full","placeholder:text-gray-400"],["type","password","id","password","name","password","ngModel","","required","","placeholder","Password",1,"input","input-bordered","block","mb-2","w-full","placeholder:text-gray-400"],[1,"flex","justify-end","mb-8"],["type","button",1,"text-sm"],[1,"error-message","text-red-500","text-sm","mb-4"],["type","submit",1,"login-2FA-button","btn","btn-block","btn-primary",3,"disabled"],["type","submit",1,"setup-2FA-button","btn","btn-block","btn-primary",3,"disabled"],[1,"loading","loading-spinner","loading-xs"],[1,"mt-4","text-lg"],["alt","QR Code",1,"mt-2",3,"src"]],template:function(e,n){if(e&1){let w=T();a(0,"div",1)(1,"div",2)(2,"h2",3),s(3,"Login"),r(),a(4,"div",4)(5,"button",5),f("click",function(){return d(w),p(n.setTwoFactorloginActive(!0))}),s(6," With Two Factor "),r(),a(7,"button",5),f("click",function(){return d(w),p(n.setTwoFactorloginActive(!1))}),s(8," Two Factor setup "),r()(),a(9,"form",6,0),f("ngSubmit",function(){d(w);let R=v(10);return p(n.onSubmit(R))}),b(11,"input",7)(12,"input",8),a(13,"div",9)(14,"button",10),s(15,"Forgot password?"),r()(),g(16,U,2,1,"div",11)(17,z,3,3,"button",12)(18,G,2,2,"button",13),r(),g(19,W,3,1),r()()}e&2&&(o(5),x("btn-primary",n.twoFactorloginActive()),o(2),x("btn-primary",!n.twoFactorloginActive()),o(9),c(n.errorMessage()?16:-1),o(),c(n.twoFactorloginActive()?17:18),o(2),c(n.qrCodeUrl()?19:-1))},dependencies:[O,q,M,V,N,j,I,D,k],encapsulation:2})};export{P as LoginComponent};
