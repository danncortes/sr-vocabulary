import{i as M}from"./chunk-KPIJLQRU.js";import{a as V,d as N,e as k,g as D,i as q,j,p as I,q as O,r as P}from"./chunk-R2UQEXEY.js";import{Bb as _,J as L,Ka as S,Ma as o,Q as y,Qa as A,Wa as T,_a as u,db as C,eb as g,fb as h,hb as c,ja as m,ka as p,lb as a,m as F,mb as r,nb as b,pb as E,rb as f,sb as d,ya as l,yb as v,zb as s}from"./chunk-2KB3ONHQ.js";function Q(n,i){if(n&1&&(a(0,"div",11),s(1),r()),n&2){let e=d();o(),_(" ",e.errorMessage()," ")}}function z(n,i){n&1&&b(0,"span",14)}function G(n,i){if(n&1&&(a(0,"button",12),s(1),u(2,z,1,0,"span",14),r()),n&2){let e=d(),t=v(10);g("disabled",!t.valid||e.isLoading()),o(),_(" ",e.isLoading()?"Logging in...":"Login with 2FA"," "),o(),c(e.isLoading()?2:-1)}}function W(n,i){if(n&1&&(a(0,"button",13),s(1),r()),n&2){let e=d(),t=v(10);g("disabled",!t.valid||e.isLoading()),o(),_(" ",e.isLoading()?"Loading...":"Get 2FA QR"," ")}}function B(n,i){if(n&1&&(a(0,"h3",15),s(1," Scan this QR code with your authenticator app: "),r(),b(2,"img",16)),n&2){let e=d();o(2),g("src",e.qrCodeUrl(),S)}}var R=class n{constructor(i){this.authService=i}isLoading=l(!1);errorMessage=l("");subscriptions=[];qrCodeUrl=l("");twoFactorloginActive=l(!0);onSubmit(i){if(i.valid){this.errorMessage.set(""),this.isLoading.set(!0);let e=this.getTwoFactorCode().pipe(y(t=>this.authService.login(i.value.email,i.value.password,t)),L(()=>{this.isLoading.set(!1)})).subscribe({error:t=>{this.errorMessage.set(t.message||"Login failed")}});this.subscriptions.push(e)}}getTwoFactorCode(){return F(new Promise(i=>{let e=prompt("Enter your 2FA code:");i(e||"")}))}setTwoFactorloginActive(i){this.twoFactorloginActive.set(i)}ngOnDestroy(){this.subscriptions.forEach(i=>i.unsubscribe())}static \u0275fac=function(e){return new(e||n)(A(M))};static \u0275cmp=T({type:n,selectors:[["app-login"]],decls:20,vars:9,consts:[["loginForm","ngForm"],[1,"h-screen","bg-gray-200","flex","justify-center","items-center"],[1,"p-6","bg-white","rounded-lg","shadow-lg","w-96"],[1,"mb-6","text-xl"],[1,"join","mb-6","w-full"],[1,"btn","btn-sm","join-item","basis-1/2",3,"click"],[3,"ngSubmit"],["type","email","id","email","name","email","ngModel","","required","","email","","placeholder","Email",1,"input","input-bordered","block","mb-6","w-full","placeholder:text-gray-400"],["type","password","id","password","name","password","ngModel","","required","","placeholder","Password",1,"input","input-bordered","block","mb-2","w-full","placeholder:text-gray-400"],[1,"flex","justify-end","mb-8"],["type","button",1,"text-sm"],[1,"error-message","text-red-500","text-sm","mb-4"],["type","submit",1,"login-2FA-button","btn","btn-block","btn-primary",3,"disabled"],["type","submit",1,"setup-2FA-button","btn","btn-block","btn-primary",3,"disabled"],[1,"loading","loading-spinner","loading-xs"],[1,"mt-4","text-lg"],["alt","QR Code",1,"mt-2",3,"src"]],template:function(e,t){if(e&1){let w=E();a(0,"div",1)(1,"div",2)(2,"h2",3),s(3,"Login"),r(),a(4,"div",4)(5,"button",5),f("click",function(){return m(w),p(t.setTwoFactorloginActive(!0))}),s(6," With Two Factor "),r(),a(7,"button",5),f("click",function(){return m(w),p(t.setTwoFactorloginActive(!1))}),s(8," Two Factor setup "),r()(),a(9,"form",6,0),f("ngSubmit",function(){m(w);let U=v(10);return p(t.onSubmit(U))}),b(11,"input",7)(12,"input",8),a(13,"div",9)(14,"button",10),s(15,"Forgot password?"),r()(),u(16,Q,2,1,"div",11)(17,G,3,3,"button",12)(18,W,2,2,"button",13),r(),u(19,B,3,1),r()()}e&2&&(o(5),h("btn-primary",t.twoFactorloginActive()),o(2),h("btn-primary",!t.twoFactorloginActive()),o(4),C("disabled",t.isLoading()?!0:null),o(),C("disabled",t.isLoading()?!0:null),o(4),c(t.errorMessage()?16:-1),o(),c(t.twoFactorloginActive()?17:18),o(2),c(t.qrCodeUrl()?19:-1))},dependencies:[P,j,V,N,k,I,O,q,D],encapsulation:2})};export{R as LoginComponent};
