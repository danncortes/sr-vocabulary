import{a as I,b as E,c as be,d as k,e as fe,f as ye,h as T,i as Se,j as _e,k as Ae,l as Fe,m as Ce,n as we,o as Pe,r as Ee,s as Te}from"./chunk-553BNLEO.js";import{b as pe,d as ge,e as he,i as ve}from"./chunk-5W4MO4JS.js";import{a as Ve,b as xe,c as O,d as L,e as Ne}from"./chunk-IGSXUNXO.js";import{$ as c,$b as de,Ab as J,Bb as ne,Cb as re,Db as le,E as U,Fb as z,Hb as se,I as Q,Ib as ue,Ma as s,R as H,Sa as X,Sb as w,Tb as P,Wa as S,_a as v,a as F,cc as ce,dc as me,eb as d,fb as Z,g as Y,gb as ee,ha as $,hb as _,ja as x,ka as N,kb as n,lb as l,mb as p,ob as te,pa as M,qb as m,r as K,rb as ie,ua as D,va as h,vb as ae,wb as oe,ya as f,yb as u,zb as C}from"./chunk-3UVZE6IW.js";function ke(a,e){if(a&1&&(n(0,"div",2)(1,"span",3),u(2),l()()),a&2){let t=e.$implicit;d("className",`alert alert-${t.value.type} shadow-lg rounded-lg`),s(2),C(t.value.message)}}var R=class a{toastService=c(xe);static \u0275fac=function(t){return new(t||a)};static \u0275cmp=S({type:a,selectors:[["app-toast"]],decls:3,vars:3,consts:[[1,"toast"],[3,"className",4,"ngFor","ngForOf"],[3,"className"],[1,"text-white"]],template:function(t,i){t&1&&(n(0,"div",0),v(1,ke,3,2,"div",1),se(2,"keyvalue"),l()),t&2&&(s(),d("ngForOf",ue(2,1,i.toastService.notifications())))},dependencies:[me,de,ce],encapsulation:2})};function G(a){a||($(G),a=c(M));let e=new Y(t=>a.onDestroy(t.next.bind(t)));return t=>t.pipe(H(e))}function Le(a,e){a&1&&p(0,"span",10)}function Re(a,e){a&1&&p(0,"app-icon",11)}function Ge(a,e){a&1&&p(0,"span",10)}function je(a,e){a&1&&p(0,"app-icon",12)}var j=class a{audioService=c(L);ngControl=c(be,{optional:!0,self:!0});constructor(){this.ngControl&&(this.ngControl.valueAccessor=this)}classNames=h("");type=h("text");id=h("");placeholder=h("");label=h("");locale=h("");audioFilename=h(null);loadingAudio=h(!1);clearingAudio=h(!1);phrase="";generatingAudio=f(!1);audioGenerated=D();playAudio=D();clearAudio=D();onChange=()=>{};onTouched=()=>{};writeValue(e){this.phrase=e}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}onPhraseChange(){this.onChange(this.phrase)}onClearAudio(){this.clearAudio.emit()}onGenerateAudio(){this.phrase&&(this.generatingAudio.set(!0),this.audioService.generateAudio(this.phrase).subscribe({next:e=>{this.audioGenerated.emit(e.filename),this.generatingAudio.set(!1)},error:()=>{this.generatingAudio.set(!1)}}))}onPlayAudio(){let e=this.audioFilename();e&&this.playAudio.emit(e)}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=S({type:a,selectors:[["app-new-phrase-input"]],hostAttrs:[1,"block"],inputs:{classNames:[1,"classNames"],type:[1,"type"],id:[1,"id"],placeholder:[1,"placeholder"],label:[1,"label"],locale:[1,"locale"],audioFilename:[1,"audioFilename"],loadingAudio:[1,"loadingAudio"],clearingAudio:[1,"clearingAudio"]},outputs:{audioGenerated:"audioGenerated",playAudio:"playAudio",clearAudio:"clearAudio"},decls:18,vars:14,consts:[[1,"flex","max-sm:flex-col","gap-4","sm:items-end"],[1,"form-control","grow"],[1,"label",3,"for"],[1,"label-text"],[3,"ngModelChange","id","type","ngModel","placeholder"],[1,"flex","gap-4","justify-between"],["type","button"],[1,"flex","gap-2"],["type","button",1,"btn",3,"click","disabled"],["type","speaker-x-mark"],[1,"loading","loading-spinner","loading-xs"],["type","speaker-wave"],["type","play"]],template:function(t,i){t&1&&(n(0,"div",0)(1,"div",1)(2,"label",2)(3,"span",3),u(4),l()(),n(5,"input",4),le("ngModelChange",function(r){return re(i.phrase,r)||(i.phrase=r),r}),m("ngModelChange",function(){return i.onPhraseChange()}),l()(),n(6,"div",5)(7,"button",6),u(8),l(),n(9,"ul",7)(10,"button",8),m("click",function(){return i.onClearAudio()}),p(11,"app-icon",9),l(),n(12,"button",8),m("click",function(){return i.onGenerateAudio()}),v(13,Le,1,0,"span",10)(14,Re,1,0,"app-icon",11),l(),n(15,"button",8),m("click",function(){return i.onPlayAudio()}),v(16,Ge,1,0,"span",10)(17,je,1,0,"app-icon",12),l()()()()),t&2&&(s(2),d("for",i.id()),s(2),C(i.label()),s(),ee(i.classNames()+" flex-grow"),d("id",i.id())("type",i.type()),ne("ngModel",i.phrase),d("placeholder",i.placeholder()),s(3),C(i.locale()),s(2),d("disabled",!i.audioFilename()||i.clearingAudio()),s(2),d("disabled",!i.phrase||i.generatingAudio()),s(),_(i.generatingAudio()?13:14),s(2),d("disabled",!i.audioFilename()||i.loadingAudio()),s(),_(i.loadingAudio()?16:17))},dependencies:[Ee,I,k,Se,Ne],encapsulation:2})};function qe(a,e){a&1&&(u(0," Saving... "),p(1,"span",17))}function Ue(a,e){if(a&1&&u(0),a&2){let t=ie();J(" ",t.isEditMode()?"Save Changes":"Save"," ")}}var A="newVocabulary",b="editVocabulary",q=class a{destroyRef=c(M);vocabularyService=c(Ve);audioService=c(L);vocabularyStore=c(O);isEditMode=w(()=>this.vocabularyStore.vocabularyToEdit());translatingTarget=f(null);saving=f(!1);loadingAudio=f(null);originalAudioFilename=f(null);translatedAudioFilename=f(null);originalLocale=w(()=>this.vocabularyStore.vocabularyToEdit()?.original.locale.locale_code||this.vocabularyStore.userSettings()?.origin_lang.locale_code);translatedLocale=w(()=>this.vocabularyStore.vocabularyToEdit()?.translated.locale.locale_code||this.vocabularyStore.userSettings()?.learning_lang.locale_code);vocabularyForm=new ye({originalPhrase:new T("",{nonNullable:!0,validators:[E.required,E.minLength(2)]}),translatedPhrase:new T("",{nonNullable:!0,validators:[E.required,E.minLength(2)]}),reviewDate:new T(null),priority:new T("0",{nonNullable:!0})});constructor(){P(()=>{let e=this.vocabularyStore.vocabularyToEdit();this.vocabularyStore.isVocabularyFormOpen()&&(this.removeStoredEdit(),e?(this.initializeEditStorage(e),this.vocabularyForm.patchValue({originalPhrase:e.original.text,translatedPhrase:e.translated.text,priority:e.priority.toString(),reviewDate:e.review_date},{emitEvent:!1}),this.originalAudioFilename.set(e.original.audio_url||null),this.translatedAudioFilename.set(e.translated.audio_url||null)):this.loadFromStorage())}),this.setupAutoTranslation(),this.setupStoragePersistence()}loadFromStorage(){let e=localStorage.getItem(A);if(e){let t=JSON.parse(e);this.vocabularyForm.patchValue({originalPhrase:t.originalPhrase?.text||"",translatedPhrase:t.translatedPhrase?.text||"",priority:"0"},{emitEvent:!1}),this.originalAudioFilename.set(t.originalPhrase?.audio||null),this.translatedAudioFilename.set(t.translatedPhrase?.audio||null)}else this.initializeStorage(),this.vocabularyForm.reset({priority:"0"},{emitEvent:!1})}initializeStorage(){let e={originalPhrase:{lang:"",audio:"",text:""},translatedPhrase:{lang:"",audio:"",text:""}};localStorage.setItem(A,JSON.stringify(e))}getNewAudioFilesToDelete(e){let t=[];return e.new.originalPhrase.audio&&e.new.originalPhrase.audio!==e.original.originalPhrase.audio&&t.push(e.new.originalPhrase.audio),e.new.translatedPhrase.audio&&e.new.translatedPhrase.audio!==e.original.translatedPhrase.audio&&t.push(e.new.translatedPhrase.audio),t}initializeEditStorage(e){let t={originalPhrase:{lang:e.original.locale.locale_code,audio:e.original.audio_url||"",text:e.original.text},translatedPhrase:{lang:e.translated.locale.locale_code,audio:e.translated.audio_url||"",text:e.translated.text},reviewDate:e.review_date,priority:e.priority.toString()},i={vocabularyId:e.id,original:F({},t),new:F({},t)};localStorage.setItem(b,JSON.stringify(i))}saveToStorage(){let{originalPhrase:e,translatedPhrase:t,reviewDate:i,priority:o}=this.vocabularyForm.value;if(this.isEditMode()){let g=localStorage.getItem(b);if(g){let y=JSON.parse(g);y.new={originalPhrase:{lang:this.originalLocale()||"",audio:this.originalAudioFilename()||"",text:e||""},translatedPhrase:{lang:this.translatedLocale()||"",audio:this.translatedAudioFilename()||"",text:t||""},reviewDate:i||null,priority:o||"0"},localStorage.setItem(b,JSON.stringify(y))}return}let r={originalPhrase:{lang:this.originalLocale()||"",audio:this.originalAudioFilename()||"",text:e||""},translatedPhrase:{lang:this.translatedLocale()||"",audio:this.translatedAudioFilename()||"",text:t||""}};localStorage.setItem(A,JSON.stringify(r))}setupStoragePersistence(){this.vocabularyForm.valueChanges.pipe(G(this.destroyRef),U(500)).subscribe(()=>{this.saveToStorage()})}setupAutoTranslation(){this.setupTranslationListener(this.vocabularyForm.controls.originalPhrase,this.vocabularyForm.controls.translatedPhrase,this.originalLocale,this.translatedLocale,"translated"),this.setupTranslationListener(this.vocabularyForm.controls.translatedPhrase,this.vocabularyForm.controls.originalPhrase,this.translatedLocale,this.originalLocale,"original")}setupTranslationListener(e,t,i,o,r){e.valueChanges.pipe(G(this.destroyRef),U(2e3),Q()).subscribe(g=>{let y=i(),V=o();y&&V&&(this.translatingTarget.set(r),this.vocabularyService.translatePhrase(g,y,V).subscribe({next:Ie=>{t.setValue(Ie.translatedPhrase,{emitEvent:!1}),this.translatingTarget.set(null),this.saveToStorage()},error:()=>{this.translatingTarget.set(null)}}))})}onAudioGenerated(e,t){let i=t==="original"?this.originalAudioFilename():this.translatedAudioFilename(),o=null;if(this.isEditMode()){let g=localStorage.getItem(b);if(g){let y=JSON.parse(g),V=t==="original"?y.original.originalPhrase.audio:y.original.translatedPhrase.audio;i&&i!==V&&(o=i)}}else i&&(o=i);let r=()=>{t==="original"?this.originalAudioFilename.set(e):this.translatedAudioFilename.set(e),this.saveToStorage()};o?this.audioService.deleteAudios([o]).subscribe({next:r,error:r}):r()}onPlayAudio(e,t){this.loadingAudio.set(t),this.audioService.playAudio(e).subscribe({next:()=>{this.loadingAudio.set(null)},error:()=>{this.loadingAudio.set(null)}})}onClearAudio(e){let t=e==="original"?this.originalAudioFilename():this.translatedAudioFilename();if(t)if(this.isEditMode()){let i=localStorage.getItem(b);if(i){let o=JSON.parse(i),r=e==="original"?o.original.originalPhrase.audio:o.original.translatedPhrase.audio;if(t!==r){let g=()=>{e==="original"?this.originalAudioFilename.set(r||null):this.translatedAudioFilename.set(r||null),this.saveToStorage()};this.audioService.deleteAudios([t]).subscribe({next:g,error:g})}}}else{let i=()=>{e==="original"?this.originalAudioFilename.set(null):this.translatedAudioFilename.set(null),this.saveToStorage()};this.audioService.deleteAudios([t]).subscribe({next:i,error:i})}}submitForm(){let{originalPhrase:e,translatedPhrase:t,reviewDate:i,priority:o}=this.vocabularyForm.value;if(this.saving.set(!0),this.isEditMode()){let r=this.vocabularyStore.vocabularyToEdit().id;this.vocabularyStore.updateVocabulary({vocabularyId:r,originalPhrase:{audioUrl:this.originalAudioFilename()||"",text:e||""},translatedPhrase:{audioUrl:this.translatedAudioFilename()||"",text:t||""},reviewDate:i||null,priority:Number(o)}).subscribe({next:()=>{localStorage.removeItem(b),this.vocabularyStore.closeVocabularyForm(),this.saving.set(!1)},error:()=>{this.saving.set(!1)}})}else{let r=this.vocabularyStore.userSettings()?.origin_lang.id,g=this.vocabularyStore.userSettings()?.learning_lang.id;this.vocabularyStore.createVocabulary({originalPhrase:{audioUrl:this.originalAudioFilename()||"",text:e,localeId:r},translatedPhrase:{audioUrl:this.translatedAudioFilename()||"",text:t,localeId:g},reviewDate:i,priority:Number(o)}).subscribe({next:()=>{localStorage.removeItem(A),this.vocabularyStore.closeVocabularyForm(),this.saving.set(!1)},error:()=>{this.saving.set(!1)}})}}cancelForm(){if(this.isEditMode()){this.removeStoredEdit(),this.vocabularyForm.reset({priority:"0"},{emitEvent:!1}),this.vocabularyStore.closeVocabularyForm();return}else{let e=[];if(this.originalAudioFilename()&&e.push(this.originalAudioFilename()),this.translatedAudioFilename()&&e.push(this.translatedAudioFilename()),e.length>0){this.audioService.deleteAudios(e).subscribe({next:()=>{localStorage.removeItem(A),this.vocabularyStore.closeVocabularyForm()},error:()=>{localStorage.removeItem(A),this.vocabularyStore.closeVocabularyForm()}});return}localStorage.removeItem(A)}this.vocabularyStore.closeVocabularyForm()}resetForm(){if(this.isEditMode()){let e=localStorage.getItem(b);if(!e)return;let t=JSON.parse(e),i=this.getNewAudioFilesToDelete(t),o=()=>{this.vocabularyForm.patchValue({originalPhrase:t.original.originalPhrase.text,translatedPhrase:t.original.translatedPhrase.text,priority:t.original.priority,reviewDate:t.original.reviewDate},{emitEvent:!1}),this.originalAudioFilename.set(t.original.originalPhrase.audio||null),this.translatedAudioFilename.set(t.original.translatedPhrase.audio||null),t.new=F({},t.original),localStorage.setItem(b,JSON.stringify(t))};i.length>0&&this.audioService.deleteAudios(i).subscribe({next:o,error:o}),o()}else{let e=[];this.originalAudioFilename()&&e.push(this.originalAudioFilename()),this.translatedAudioFilename()&&e.push(this.translatedAudioFilename());let t=()=>{this.vocabularyForm.reset({priority:"0"},{emitEvent:!1}),this.originalAudioFilename.set(null),this.translatedAudioFilename.set(null),this.initializeStorage()};e.length>0?this.audioService.deleteAudios(e).subscribe({next:t,error:t}):t()}}removeStoredEdit(){let e=localStorage.getItem(b);if(e){let t=JSON.parse(e),i=this.getNewAudioFilesToDelete(t);i.length>0&&K(this.audioService.deleteAudios(i)),localStorage.removeItem(b)}}ngOnDestroy(){this.removeStoredEdit()}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=S({type:a,selectors:[["app-vocabulary-form"]],decls:30,vars:12,consts:[[1,"text-lg","font-bold"],["action","",1,"space-y-3",3,"ngSubmit","formGroup"],["formControlName","originalPhrase","type","text","classNames","input input-bordered","id","original-phrase-input","label","Original Phrase",3,"audioGenerated","playAudio","clearAudio","placeholder","locale","audioFilename","loadingAudio"],["formControlName","translatedPhrase","type","text","classNames","input input-bordered","id","translated-phrase-input","label","Translated Phrase",3,"audioGenerated","playAudio","clearAudio","placeholder","locale","audioFilename","loadingAudio"],[1,"flex","gap-2"],[1,"form-control","flex-1"],["for","review-date-input",1,"label"],[1,"label-text"],["id","review-date-input","type","date","placeholder","Type a date for review (e.g., 2024-12-31)","formControlName","reviewDate",1,"input","input-bordered"],["for","priority-input",1,"label"],["formControlName","priority",1,"select","select-ghost"],["value","0"],["value","1"],["value","2"],[1,"form-control","flex","flex-row","gap-2","!mt-6"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary","grow",3,"disabled"],[1,"loading","loading-spinner","loading-xs"]],template:function(t,i){t&1&&(n(0,"h2",0),u(1),l(),n(2,"form",1),m("ngSubmit",function(){return i.submitForm()}),n(3,"app-new-phrase-input",2),m("audioGenerated",function(r){return i.onAudioGenerated(r,"original")})("playAudio",function(r){return i.onPlayAudio(r,"original")})("clearAudio",function(){return i.onClearAudio("original")}),l(),n(4,"app-new-phrase-input",3),m("audioGenerated",function(r){return i.onAudioGenerated(r,"translated")})("playAudio",function(r){return i.onPlayAudio(r,"translated")})("clearAudio",function(){return i.onClearAudio("translated")}),l(),n(5,"div",4)(6,"div",5)(7,"label",6)(8,"span",7),u(9,"Review Date"),l()(),p(10,"input",8),l(),n(11,"div",5)(12,"label",9)(13,"span",7),u(14,"Priority"),l()(),n(15,"select",10)(16,"option",11),u(17,"0"),l(),n(18,"option",12),u(19,"1"),l(),n(20,"option",13),u(21,"2"),l()()()(),n(22,"div",14)(23,"button",15),m("click",function(){return i.cancelForm()}),u(24,"Cancel"),l(),n(25,"button",15),m("click",function(){return i.resetForm()}),u(26,"Reset"),l(),n(27,"button",16),v(28,qe,2,0)(29,Ue,1,1),l()()()),t&2&&(s(),J(" ",i.isEditMode()?"Edit Vocabulary":"Create Vocabulary",`
`),s(),d("formGroup",i.vocabularyForm),s(),d("placeholder",i.translatingTarget()==="original"?"Generating...":"Type a phrase in your original language")("locale",i.originalLocale())("audioFilename",i.originalAudioFilename())("loadingAudio",i.loadingAudio()==="original"),s(),d("placeholder",i.translatingTarget()==="translated"?"Generating...":"Type a phrase in your translated language")("locale",i.translatedLocale())("audioFilename",i.translatedAudioFilename())("loadingAudio",i.loadingAudio()==="translated"),s(23),d("disabled",i.vocabularyForm.invalid||i.saving()),s(),_(i.saving()?28:29))},dependencies:[Te,_e,we,Pe,I,Ce,k,fe,Ae,Fe,j],encapsulation:2})};var Je=["vocabularyFormModal"],Me=()=>({exact:!0});function ze(a,e){a&1&&p(0,"span",9)}function Be(a,e){a&1&&p(0,"router-outlet")}function We(a,e){a&1&&p(0,"app-vocabulary-form")}var De=class a{authService=c(ve);vocabularyStore=c(O);vocabularyFormModal=X("vocabularyFormModal");constructor(){P(()=>{let e=this.vocabularyStore.isVocabularyFormOpen(),t=this.vocabularyFormModal();t&&(e?t.nativeElement.showModal():t.nativeElement.close())})}ngOnInit(){this.vocabularyStore.initializeAppData()}logout(){this.authService.logout()}openVocabularyForm(){this.vocabularyStore.openVocabularyForm()}onModalClose(){this.vocabularyStore.closeVocabularyForm()}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=S({type:a,selectors:[["app-main-layout"]],viewQuery:function(t,i){t&1&&ae(i.vocabularyFormModal,Je,5),t&2&&oe()},decls:22,vars:8,consts:[["vocabularyFormModal",""],[1,"main-layout","sm:pt-20","px-6","pb-6"],[1,"flex","justify-between","p-6","bg-white","sm:fixed","top-0","left-0","right-0"],[1,"flex","gap-4","items-center"],[1,"btn","btn-primary","btn-sm",3,"click"],[1,"flex","gap-2"],["routerLink","/dashboard","routerLinkActive","btn-primary",1,"btn","btn-ghost","btn-sm",3,"routerLinkActiveOptions"],["routerLink","/vocabulary","routerLinkActive","btn-primary",1,"btn","btn-ghost","btn-sm",3,"routerLinkActiveOptions"],[1,"cursor-pointer",3,"click"],[1,"loading","loading-spinner","loading-xl"],["id","vocabularyFormModal",1,"modal",3,"close"],[1,"modal-box","max-w-3xl"],["method","dialog",1,"modal-backdrop"]],template:function(t,i){if(t&1){let o=te();n(0,"div",1),p(1,"app-toast"),n(2,"div",2)(3,"div",3)(4,"button",4),m("click",function(){return x(o),N(i.openVocabularyForm())}),u(5," + Create vocabulary "),l(),n(6,"nav",5)(7,"a",6),u(8," Dashboard "),l(),n(9,"a",7),u(10," Vocabulary "),l()()(),n(11,"button",8),m("click",function(){return x(o),N(i.logout())}),u(12,"Logout"),l()(),v(13,ze,1,0,"span",9)(14,Be,1,0,"router-outlet"),n(15,"dialog",10,0),m("close",function(){return x(o),N(i.onModalClose())}),n(17,"div",11),v(18,We,1,0,"app-vocabulary-form"),l(),n(19,"form",12)(20,"button"),u(21,"close"),l()()()()}t&2&&(s(7),Z("btn-primary",!1),d("routerLinkActiveOptions",z(6,Me)),s(2),d("routerLinkActiveOptions",z(7,Me)),s(4),_(i.vocabularyStore.loading()?13:14),s(5),_(i.vocabularyStore.isVocabularyFormOpen()?18:-1))},dependencies:[pe,ge,he,R,q],encapsulation:2})};export{De as MainLayoutComponent};
