import{a as I,b as E,c as fe,d as k,e as ye,f as Se,h as T,i as _e,j as Ae,k as Fe,l as Ce,m as we,n as Pe,o as Ee,r as Te,s as Ve}from"./chunk-ZFK3BMR5.js";import{b as ge,d as he,e as ve,i as be}from"./chunk-57FJJQQ2.js";import{a as xe,b as Ne,c as O,d as L,e as R}from"./chunk-2EQRTUHJ.js";import{$ as m,$b as ce,Ab as z,Bb as re,Cb as le,Db as se,E as J,Fb as B,Hb as ue,I as H,Ib as de,Ma as s,R as $,Sa as Z,Sb as w,Tb as P,Wa as S,_a as v,a as F,cc as me,dc as pe,eb as d,fb as ee,g as K,gb as te,ha as X,hb as _,ja as x,ka as N,kb as n,lb as l,mb as c,ob as ie,pa as M,qb as p,r as Q,rb as ae,ua as D,va as h,vb as oe,wb as ne,ya as f,yb as u,zb as C}from"./chunk-EO24PUO4.js";function ke(a,e){if(a&1&&(n(0,"div",2)(1,"span",3),u(2),l()()),a&2){let t=e.$implicit;d("className",`alert alert-${t.value.type} shadow-lg rounded-lg`),s(2),C(t.value.message)}}var G=class a{toastService=m(Ne);static \u0275fac=function(t){return new(t||a)};static \u0275cmp=S({type:a,selectors:[["app-toast"]],decls:3,vars:3,consts:[[1,"toast"],[3,"className",4,"ngFor","ngForOf"],[3,"className"],[1,"text-white"]],template:function(t,i){t&1&&(n(0,"div",0),v(1,ke,3,2,"div",1),ue(2,"keyvalue"),l()),t&2&&(s(),d("ngForOf",de(2,1,i.toastService.notifications())))},dependencies:[pe,ce,me],encapsulation:2})};function j(a){a||(X(j),a=m(M));let e=new K(t=>a.onDestroy(t.next.bind(t)));return t=>t.pipe($(e))}function Le(a,e){a&1&&c(0,"span",10)}function Re(a,e){a&1&&c(0,"app-icon",11)}function Ge(a,e){a&1&&c(0,"span",10)}function je(a,e){a&1&&c(0,"app-icon",12)}var q=class a{audioService=m(L);ngControl=m(fe,{optional:!0,self:!0});constructor(){this.ngControl&&(this.ngControl.valueAccessor=this)}classNames=h("");type=h("text");id=h("");placeholder=h("");label=h("");locale=h("");audioFilename=h(null);loadingAudio=h(!1);clearingAudio=h(!1);phrase="";generatingAudio=f(!1);audioGenerated=D();playAudio=D();clearAudio=D();onChange=()=>{};onTouched=()=>{};writeValue(e){this.phrase=e}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}onPhraseChange(){this.onChange(this.phrase)}onClearAudio(){this.clearAudio.emit()}onGenerateAudio(){this.phrase&&(this.generatingAudio.set(!0),this.audioService.generateAudio(this.phrase).subscribe({next:e=>{this.audioGenerated.emit(e.filename),this.generatingAudio.set(!1)},error:()=>{this.generatingAudio.set(!1)}}))}onPlayAudio(){let e=this.audioFilename();e&&this.playAudio.emit(e)}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=S({type:a,selectors:[["app-new-phrase-input"]],hostAttrs:[1,"block"],inputs:{classNames:[1,"classNames"],type:[1,"type"],id:[1,"id"],placeholder:[1,"placeholder"],label:[1,"label"],locale:[1,"locale"],audioFilename:[1,"audioFilename"],loadingAudio:[1,"loadingAudio"],clearingAudio:[1,"clearingAudio"]},outputs:{audioGenerated:"audioGenerated",playAudio:"playAudio",clearAudio:"clearAudio"},decls:18,vars:14,consts:[[1,"flex","max-sm:flex-col","gap-4","sm:items-end"],[1,"form-control","grow"],[1,"label",3,"for"],[1,"label-text"],[3,"ngModelChange","id","type","ngModel","placeholder"],[1,"flex","gap-4","justify-between"],["type","button"],[1,"flex","gap-2"],["type","button",1,"btn",3,"click","disabled"],["type","speaker-x-mark"],[1,"loading","loading-spinner","loading-xs"],["type","speaker-wave"],["type","play"]],template:function(t,i){t&1&&(n(0,"div",0)(1,"div",1)(2,"label",2)(3,"span",3),u(4),l()(),n(5,"input",4),se("ngModelChange",function(r){return le(i.phrase,r)||(i.phrase=r),r}),p("ngModelChange",function(){return i.onPhraseChange()}),l()(),n(6,"div",5)(7,"button",6),u(8),l(),n(9,"ul",7)(10,"button",8),p("click",function(){return i.onClearAudio()}),c(11,"app-icon",9),l(),n(12,"button",8),p("click",function(){return i.onGenerateAudio()}),v(13,Le,1,0,"span",10)(14,Re,1,0,"app-icon",11),l(),n(15,"button",8),p("click",function(){return i.onPlayAudio()}),v(16,Ge,1,0,"span",10)(17,je,1,0,"app-icon",12),l()()()()),t&2&&(s(2),d("for",i.id()),s(2),C(i.label()),s(),te(i.classNames()+" flex-grow"),d("id",i.id())("type",i.type()),re("ngModel",i.phrase),d("placeholder",i.placeholder()),s(3),C(i.locale()),s(2),d("disabled",!i.audioFilename()||i.clearingAudio()),s(2),d("disabled",!i.phrase||i.generatingAudio()),s(),_(i.generatingAudio()?13:14),s(2),d("disabled",!i.audioFilename()||i.loadingAudio()),s(),_(i.loadingAudio()?16:17))},dependencies:[Te,I,k,_e,R],encapsulation:2})};function qe(a,e){a&1&&(u(0," Saving... "),c(1,"span",17))}function Ue(a,e){if(a&1&&u(0),a&2){let t=ae();z(" ",t.isEditMode()?"Save Changes":"Save"," ")}}var A="newVocabulary",b="editVocabulary",U=class a{destroyRef=m(M);vocabularyService=m(xe);audioService=m(L);vocabularyStore=m(O);isEditMode=w(()=>this.vocabularyStore.vocabularyToEdit());translatingTarget=f(null);saving=f(!1);loadingAudio=f(null);originalAudioFilename=f(null);translatedAudioFilename=f(null);originalLocale=w(()=>this.vocabularyStore.vocabularyToEdit()?.original.locale.locale_code||this.vocabularyStore.userSettings()?.origin_lang.locale_code);translatedLocale=w(()=>this.vocabularyStore.vocabularyToEdit()?.translated.locale.locale_code||this.vocabularyStore.userSettings()?.learning_lang.locale_code);vocabularyForm=new Se({originalPhrase:new T("",{nonNullable:!0,validators:[E.required,E.minLength(2)]}),translatedPhrase:new T("",{nonNullable:!0,validators:[E.required,E.minLength(2)]}),reviewDate:new T(null),priority:new T("0",{nonNullable:!0})});constructor(){P(()=>{let e=this.vocabularyStore.vocabularyToEdit();this.vocabularyStore.isVocabularyFormOpen()&&(this.removeStoredEdit(),e?(this.initializeEditStorage(e),this.vocabularyForm.patchValue({originalPhrase:e.original.text,translatedPhrase:e.translated.text,priority:e.priority.toString(),reviewDate:e.review_date},{emitEvent:!1}),this.originalAudioFilename.set(e.original.audio_url||null),this.translatedAudioFilename.set(e.translated.audio_url||null)):this.loadFromStorage())}),this.setupAutoTranslation(),this.setupStoragePersistence()}loadFromStorage(){let e=localStorage.getItem(A);if(e){let t=JSON.parse(e);this.vocabularyForm.patchValue({originalPhrase:t.originalPhrase?.text||"",translatedPhrase:t.translatedPhrase?.text||"",priority:"0"},{emitEvent:!1}),this.originalAudioFilename.set(t.originalPhrase?.audio||null),this.translatedAudioFilename.set(t.translatedPhrase?.audio||null)}else this.initializeStorage(),this.vocabularyForm.reset({priority:"0"},{emitEvent:!1})}initializeStorage(){let e={originalPhrase:{lang:"",audio:"",text:""},translatedPhrase:{lang:"",audio:"",text:""}};localStorage.setItem(A,JSON.stringify(e))}getNewAudioFilesToDelete(e){let t=[];return e.new.originalPhrase.audio&&e.new.originalPhrase.audio!==e.original.originalPhrase.audio&&t.push(e.new.originalPhrase.audio),e.new.translatedPhrase.audio&&e.new.translatedPhrase.audio!==e.original.translatedPhrase.audio&&t.push(e.new.translatedPhrase.audio),t}initializeEditStorage(e){let t={originalPhrase:{lang:e.original.locale.locale_code,audio:e.original.audio_url||"",text:e.original.text},translatedPhrase:{lang:e.translated.locale.locale_code,audio:e.translated.audio_url||"",text:e.translated.text},reviewDate:e.review_date,priority:e.priority.toString()},i={vocabularyId:e.id,original:F({},t),new:F({},t)};localStorage.setItem(b,JSON.stringify(i))}saveToStorage(){let{originalPhrase:e,translatedPhrase:t,reviewDate:i,priority:o}=this.vocabularyForm.value;if(this.isEditMode()){let g=localStorage.getItem(b);if(g){let y=JSON.parse(g);y.new={originalPhrase:{lang:this.originalLocale()||"",audio:this.originalAudioFilename()||"",text:e||""},translatedPhrase:{lang:this.translatedLocale()||"",audio:this.translatedAudioFilename()||"",text:t||""},reviewDate:i||null,priority:o||"0"},localStorage.setItem(b,JSON.stringify(y))}return}let r={originalPhrase:{lang:this.originalLocale()||"",audio:this.originalAudioFilename()||"",text:e||""},translatedPhrase:{lang:this.translatedLocale()||"",audio:this.translatedAudioFilename()||"",text:t||""}};localStorage.setItem(A,JSON.stringify(r))}setupStoragePersistence(){this.vocabularyForm.valueChanges.pipe(j(this.destroyRef),J(500)).subscribe(()=>{this.saveToStorage()})}setupAutoTranslation(){this.setupTranslationListener(this.vocabularyForm.controls.originalPhrase,this.vocabularyForm.controls.translatedPhrase,this.originalLocale,this.translatedLocale,"translated"),this.setupTranslationListener(this.vocabularyForm.controls.translatedPhrase,this.vocabularyForm.controls.originalPhrase,this.translatedLocale,this.originalLocale,"original")}setupTranslationListener(e,t,i,o,r){e.valueChanges.pipe(j(this.destroyRef),J(2e3),H()).subscribe(g=>{let y=i(),V=o();y&&V&&(this.translatingTarget.set(r),this.vocabularyService.translatePhrase(g,y,V).subscribe({next:Ie=>{t.setValue(Ie.translatedPhrase,{emitEvent:!1}),this.translatingTarget.set(null),this.saveToStorage()},error:()=>{this.translatingTarget.set(null)}}))})}onAudioGenerated(e,t){let i=t==="original"?this.originalAudioFilename():this.translatedAudioFilename(),o=null;if(this.isEditMode()){let g=localStorage.getItem(b);if(g){let y=JSON.parse(g),V=t==="original"?y.original.originalPhrase.audio:y.original.translatedPhrase.audio;i&&i!==V&&(o=i)}}else i&&(o=i);let r=()=>{t==="original"?this.originalAudioFilename.set(e):this.translatedAudioFilename.set(e),this.saveToStorage()};o?this.audioService.deleteAudios([o]).subscribe({next:r,error:r}):r()}onPlayAudio(e,t){this.loadingAudio.set(t),this.audioService.playAudio(e).subscribe({next:()=>{this.loadingAudio.set(null)},error:()=>{this.loadingAudio.set(null)}})}onClearAudio(e){let t=e==="original"?this.originalAudioFilename():this.translatedAudioFilename();if(t)if(this.isEditMode()){let i=localStorage.getItem(b);if(i){let o=JSON.parse(i),r=e==="original"?o.original.originalPhrase.audio:o.original.translatedPhrase.audio;if(t!==r){let g=()=>{e==="original"?this.originalAudioFilename.set(r||null):this.translatedAudioFilename.set(r||null),this.saveToStorage()};this.audioService.deleteAudios([t]).subscribe({next:g,error:g})}}}else{let i=()=>{e==="original"?this.originalAudioFilename.set(null):this.translatedAudioFilename.set(null),this.saveToStorage()};this.audioService.deleteAudios([t]).subscribe({next:i,error:i})}}submitForm(){let{originalPhrase:e,translatedPhrase:t,reviewDate:i,priority:o}=this.vocabularyForm.value;if(this.saving.set(!0),this.isEditMode()){let r=this.vocabularyStore.vocabularyToEdit().id;this.vocabularyStore.updateVocabulary({vocabularyId:r,originalPhrase:{audioUrl:this.originalAudioFilename()||"",text:e||""},translatedPhrase:{audioUrl:this.translatedAudioFilename()||"",text:t||""},reviewDate:i||null,priority:Number(o)}).subscribe({next:()=>{localStorage.removeItem(b),this.vocabularyStore.closeVocabularyForm(),this.saving.set(!1)},error:()=>{this.saving.set(!1)}})}else{let r=this.vocabularyStore.userSettings()?.origin_lang.id,g=this.vocabularyStore.userSettings()?.learning_lang.id;this.vocabularyStore.createVocabulary({originalPhrase:{audioUrl:this.originalAudioFilename()||"",text:e,localeId:r},translatedPhrase:{audioUrl:this.translatedAudioFilename()||"",text:t,localeId:g},reviewDate:i,priority:Number(o)}).subscribe({next:()=>{localStorage.removeItem(A),this.vocabularyStore.closeVocabularyForm(),this.saving.set(!1)},error:()=>{this.saving.set(!1)}})}}cancelForm(){if(this.isEditMode()){this.removeStoredEdit(),this.vocabularyForm.reset({priority:"0"},{emitEvent:!1}),this.vocabularyStore.closeVocabularyForm();return}else{let e=[];if(this.originalAudioFilename()&&e.push(this.originalAudioFilename()),this.translatedAudioFilename()&&e.push(this.translatedAudioFilename()),e.length>0){this.audioService.deleteAudios(e).subscribe({next:()=>{localStorage.removeItem(A),this.vocabularyStore.closeVocabularyForm()},error:()=>{localStorage.removeItem(A),this.vocabularyStore.closeVocabularyForm()}});return}localStorage.removeItem(A)}this.vocabularyStore.closeVocabularyForm()}resetForm(){if(this.isEditMode()){let e=localStorage.getItem(b);if(!e)return;let t=JSON.parse(e),i=this.getNewAudioFilesToDelete(t),o=()=>{this.vocabularyForm.patchValue({originalPhrase:t.original.originalPhrase.text,translatedPhrase:t.original.translatedPhrase.text,priority:t.original.priority,reviewDate:t.original.reviewDate},{emitEvent:!1}),this.originalAudioFilename.set(t.original.originalPhrase.audio||null),this.translatedAudioFilename.set(t.original.translatedPhrase.audio||null),t.new=F({},t.original),localStorage.setItem(b,JSON.stringify(t))};i.length>0&&this.audioService.deleteAudios(i).subscribe({next:o,error:o}),o()}else{let e=[];this.originalAudioFilename()&&e.push(this.originalAudioFilename()),this.translatedAudioFilename()&&e.push(this.translatedAudioFilename());let t=()=>{this.vocabularyForm.reset({priority:"0"},{emitEvent:!1}),this.originalAudioFilename.set(null),this.translatedAudioFilename.set(null),this.initializeStorage()};e.length>0?this.audioService.deleteAudios(e).subscribe({next:t,error:t}):t()}}removeStoredEdit(){let e=localStorage.getItem(b);if(e){let t=JSON.parse(e),i=this.getNewAudioFilesToDelete(t);i.length>0&&Q(this.audioService.deleteAudios(i)),localStorage.removeItem(b)}}ngOnDestroy(){this.removeStoredEdit()}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=S({type:a,selectors:[["app-vocabulary-form"]],decls:30,vars:12,consts:[[1,"text-lg","font-bold"],["action","",1,"space-y-3",3,"ngSubmit","formGroup"],["formControlName","originalPhrase","type","text","classNames","input input-bordered","id","original-phrase-input","label","Original Phrase",3,"audioGenerated","playAudio","clearAudio","placeholder","locale","audioFilename","loadingAudio"],["formControlName","translatedPhrase","type","text","classNames","input input-bordered","id","translated-phrase-input","label","Translated Phrase",3,"audioGenerated","playAudio","clearAudio","placeholder","locale","audioFilename","loadingAudio"],[1,"flex","gap-2"],[1,"form-control","flex-1"],["for","review-date-input",1,"label"],[1,"label-text"],["id","review-date-input","type","date","placeholder","Type a date for review (e.g., 2024-12-31)","formControlName","reviewDate",1,"input","input-bordered"],["for","priority-input",1,"label"],["formControlName","priority",1,"select","select-ghost"],["value","0"],["value","1"],["value","2"],[1,"form-control","flex","flex-row","gap-2","!mt-6"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary","grow",3,"disabled"],[1,"loading","loading-spinner","loading-xs"]],template:function(t,i){t&1&&(n(0,"h2",0),u(1),l(),n(2,"form",1),p("ngSubmit",function(){return i.submitForm()}),n(3,"app-new-phrase-input",2),p("audioGenerated",function(r){return i.onAudioGenerated(r,"original")})("playAudio",function(r){return i.onPlayAudio(r,"original")})("clearAudio",function(){return i.onClearAudio("original")}),l(),n(4,"app-new-phrase-input",3),p("audioGenerated",function(r){return i.onAudioGenerated(r,"translated")})("playAudio",function(r){return i.onPlayAudio(r,"translated")})("clearAudio",function(){return i.onClearAudio("translated")}),l(),n(5,"div",4)(6,"div",5)(7,"label",6)(8,"span",7),u(9,"Review Date"),l()(),c(10,"input",8),l(),n(11,"div",5)(12,"label",9)(13,"span",7),u(14,"Priority"),l()(),n(15,"select",10)(16,"option",11),u(17,"0"),l(),n(18,"option",12),u(19,"1"),l(),n(20,"option",13),u(21,"2"),l()()()(),n(22,"div",14)(23,"button",15),p("click",function(){return i.cancelForm()}),u(24,"Cancel"),l(),n(25,"button",15),p("click",function(){return i.resetForm()}),u(26,"Reset"),l(),n(27,"button",16),v(28,qe,2,0)(29,Ue,1,1),l()()()),t&2&&(s(),z(" ",i.isEditMode()?"Edit Vocabulary":"Create Vocabulary",`
`),s(),d("formGroup",i.vocabularyForm),s(),d("placeholder",i.translatingTarget()==="original"?"Generating...":"Type a phrase in your original language")("locale",i.originalLocale())("audioFilename",i.originalAudioFilename())("loadingAudio",i.loadingAudio()==="original"),s(),d("placeholder",i.translatingTarget()==="translated"?"Generating...":"Type a phrase in your translated language")("locale",i.translatedLocale())("audioFilename",i.translatedAudioFilename())("loadingAudio",i.loadingAudio()==="translated"),s(23),d("disabled",i.vocabularyForm.invalid||i.saving()),s(),_(i.saving()?28:29))},dependencies:[Ve,Ae,Pe,Ee,I,we,k,ye,Fe,Ce,q],encapsulation:2})};var Je=["vocabularyFormModal"],Me=()=>({exact:!0});function ze(a,e){a&1&&c(0,"span",12)}function Be(a,e){a&1&&c(0,"router-outlet")}function We(a,e){a&1&&c(0,"app-vocabulary-form")}var De=class a{authService=m(be);vocabularyStore=m(O);vocabularyFormModal=Z("vocabularyFormModal");constructor(){P(()=>{let e=this.vocabularyStore.isVocabularyFormOpen(),t=this.vocabularyFormModal();t&&(e?t.nativeElement.showModal():t.nativeElement.close())})}ngOnInit(){this.vocabularyStore.initializeAppData()}logout(){this.authService.logout()}openVocabularyForm(){this.vocabularyStore.openVocabularyForm()}onModalClose(){this.vocabularyStore.closeVocabularyForm()}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=S({type:a,selectors:[["app-main-layout"]],viewQuery:function(t,i){t&1&&oe(i.vocabularyFormModal,Je,5),t&2&&ne()},decls:26,vars:8,consts:[["vocabularyFormModal",""],[1,"main-layout","sm:pt-20","px-6","pb-6"],[1,"flex","justify-between","py-6","sm:px-6","bg-white","sm:fixed","top-0","left-0","right-0"],[1,"flex","gap-2","items-center"],[1,"btn","btn-primary","btn-sm",3,"click"],["customClass","sm:hidden","type","plus"],[1,"hidden","sm:inline"],[1,"flex","gap-2"],["routerLink","/dashboard","routerLinkActive","btn-primary",1,"btn","btn-ghost","btn-sm",3,"routerLinkActiveOptions"],["customClass","sm:hidden","type","home"],["routerLink","/vocabulary","routerLinkActive","btn-primary",1,"btn","btn-ghost","btn-sm",3,"routerLinkActiveOptions"],[1,"cursor-pointer",3,"click"],[1,"loading","loading-spinner","loading-xl"],["id","vocabularyFormModal",1,"modal",3,"close"],[1,"modal-box","max-w-3xl"],["method","dialog",1,"modal-backdrop"]],template:function(t,i){if(t&1){let o=ie();n(0,"div",1),c(1,"app-toast"),n(2,"div",2)(3,"div",3)(4,"button",4),p("click",function(){return x(o),N(i.openVocabularyForm())}),c(5,"app-icon",5),n(6,"span",6),u(7,"+ Create vocabulary"),l()(),n(8,"nav",7)(9,"a",8),c(10,"app-icon",9),n(11,"span",6),u(12,"Dashboard"),l()(),n(13,"a",10),u(14," Vocabulary "),l()()(),n(15,"button",11),p("click",function(){return x(o),N(i.logout())}),u(16,"Logout"),l()(),v(17,ze,1,0,"span",12)(18,Be,1,0,"router-outlet"),n(19,"dialog",13,0),p("close",function(){return x(o),N(i.onModalClose())}),n(21,"div",14),v(22,We,1,0,"app-vocabulary-form"),l(),n(23,"form",15)(24,"button"),u(25,"close"),l()()()()}t&2&&(s(9),ee("btn-primary",!1),d("routerLinkActiveOptions",B(6,Me)),s(4),d("routerLinkActiveOptions",B(7,Me)),s(4),_(i.vocabularyStore.loading()?17:18),s(5),_(i.vocabularyStore.isVocabularyFormOpen()?22:-1))},dependencies:[ge,he,ve,G,U,R],encapsulation:2})};export{De as MainLayoutComponent};
